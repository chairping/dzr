<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="Cache-Control" content="no-siteapp" />
 <link href="__PUBLIC__/assets/css/bootstrap.min.css" rel="stylesheet" />
        <link rel="stylesheet" href="__PUBLIC__/css/style.css"/>
        <link href="__PUBLIC__/assets/css/codemirror.css" rel="stylesheet">
        <link rel="stylesheet" href="__PUBLIC__/assets/css/ace.min.css" />
        <link rel="stylesheet" href="__PUBLIC__/font/css/font-awesome.min.css" />
        <!--[if lte IE 8]>
		  <link rel="stylesheet" href="__PUBLIC__/assets/css/ace-ie.min.css" />
		<![endif]-->
		<script src="__PUBLIC__/js/jquery-1.9.1.min.js"></script>
		<script src="__PUBLIC__/assets/layer/layer.js" type="text/javascript" ></script>
        <script src="__PUBLIC__/assets/laydate/laydate.js" type="text/javascript"></script>
        <script src="__PUBLIC__/assets/js/bootstrap.min.js"></script>
		<script src="__PUBLIC__/assets/js/typeahead-bs2.min.js"></script>
		<script src="__PUBLIC__/assets/js/jquery.dataTables.min.js"></script>
		<script src="__PUBLIC__/assets/js/jquery.dataTables.bootstrap.js"></script>
                      
<title>个人信息管理</title>
</head>

<body>
<div class="clearfix">
 <div class="admin_info_style">
   <div class="admin_modify_style" id="Personal">
     <div class="type_title">账户信息 </div>
      <div class="xinxi">
        <div class="form-group"><label class="col-sm-4 control-label no-padding-right" for="username">账号： </label>
          <div class="col-sm-8"><input type="text" name="账号" id="username" value="{$user_info.username}" class="col-xs-7 text_info" disabled="disabled">
          &nbsp;&nbsp;&nbsp;<a href="javascript:;" onclick="change_Password()" id='change_pwd' class="btn btn-warning btn-xs">修改密码</a></div>
          
          </div>

          <php>if($user_info['type'] != 2) {</php>
              <div class="form-group"><label class="col-sm-4 control-label no-padding-right" for="weixin_account">微信账号： </label>
              <div class="col-sm-8"><input style="background:#FFF;width: 100%;" type="text" name="微信账号" id="weixin_account" value="{$user_info.weixin_account}" class="col-xs-7 text_info" disabled="disabled"></div>
              </div>
              <div class="form-group"><label class="col-sm-4 control-label no-padding-right" for="alipay_acount">支付宝账号： </label>
              <div class="col-sm-8"><input style="background:#FFF;width: 100%;" type="text" name="支付宝账号" id="alipay_acount" value="{$user_info.alipay_acount}" class="col-xs-7 text_info" disabled="disabled"></div>
              </div>
              <div class="form-group"><label class="col-sm-4 control-label no-padding-right" for="bank_name">银行名称： </label>
              <div class="col-sm-8"><input style="background:#FFF;width: 100%;" type="text" name="银行名称" id="bank_name" value="{$user_info.bank_name}" class="col-xs-7 text_info" disabled="disabled"></div>
              </div>
              <div class="form-group"><label class="col-sm-4 control-label no-padding-right" for="bank_user_name">银行卡姓名： </label>
              <div class="col-sm-8"><input style="background:#FFF;width: 100%;" type="text" name="银行卡姓名" id="bank_user_name" value="{$user_info.bank_user_name}" class="col-xs-7 text_info" disabled="disabled"> </div>
              </div>
                <div class="form-group"><label class="col-sm-4 control-label no-padding-right" for="bank_account">银行卡号： </label>
              <div class="col-sm-8"><input style="background:#FFF;width: 100%;" type="text" name="银行卡号" id="bank_account" value="{$user_info.bank_account}" class="col-xs-7 text_info" disabled="disabled"> </div>
              </div>
                <div class="form-group"><label class="col-sm-4 control-label no-padding-right" for="bank_branches">开户行网点： </label>
              <div class="col-sm-8"><input  style="background:#FFF;width: 100%;" type="text" name="开户行网点" id="bank_branches" value="{$user_info.bank_branches}" class="col-xs-7 text_info" disabled="disabled"> </div>
              </div>
            <php>}</php>
           <div class="Button_operation clearfix">
               <input type="hidden" id="id" value="{$user_info.id}"/>
               <input type="hidden" id="type" value="{$user_info.type}"/>
				<button onclick="modify();" class="btn btn-danger radius" type="submit">修改信息</button>
				<button onclick="save_info();" class="btn btn-success radius" id='save_change' type="button">保存修改</button>
			</div>
            </div>
    </div>
    <!--<div class="recording_style">-->
    <!--<div class="type_title">账户登录记录 </div>-->
    <!--<div class="recording_list">-->
     <!--<table class="table table-border table-bordered table-bg table-hover table-sort" id="sample-table">-->
    <!--<thead>-->
      <!--<tr class="text-c">-->
        <!--<th width="25"><label><input type="checkbox" class="ace"><span class="lbl"></span></label></th>-->
        <!--<th width="80">ID</th>-->

        <!--<th>内容</th>-->

        <!--<th width="10%">用户名</th>-->
        <!--<th width="120">客户端IP</th>-->
        <!--<th width="150">时间</th>-->
      <!--</tr>-->
    <!--</thead>-->
    <!--<tbody>-->
      <!--<tr>-->
        <!--<td><label><input type="checkbox" class="ace"><span class="lbl"></span></label></td>-->
        <!--<td>15686</td>-->

        <!--<td>登录成功!</td>-->

        <!--<td>admin</td>-->
        <!--<td>61.233.7.80</td>-->
        <!--<td>2014-6-11 11:11:42</td>      -->
      <!--</tr>-->
 <!--<tr>-->
        <!--<td><label><input type="checkbox" class="ace"><span class="lbl"></span></label></td>-->
        <!--<td>15686</td>-->

        <!--<td>登录成功!</td>-->

        <!--<td>admin</td>-->
        <!--<td>61.233.7.80</td>-->
        <!--<td>2014-6-11 11:11:42</td>-->
      <!--</tr>-->
 <!--<tr>-->
        <!--<td><label><input type="checkbox" class="ace"><span class="lbl"></span></label></td>-->
        <!--<td>15686</td>-->

        <!--<td>登录成功!</td>-->

        <!--<td>admin</td>-->
        <!--<td>61.233.7.80</td>-->
        <!--<td>2014-6-11 11:11:42</td>-->
      <!--</tr>-->

    <!--</tbody>-->
  <!--</table>-->
    <!--</div>-->
    <!--</div>-->
     <div class="recording_style">
         <div class="type_title">账户登录记录 </div>
         <div class="recording_list">
             <table class="table table-border table-bordered table-bg table-hover table-sort" id="sample-table">
                 <thead>
                 <tr class="text-c">
                     <th width="5%"><label><input type="checkbox" class="ace"><span class="lbl"></span></label></th>
                     <th width="10%">ID</th>
                     <th width="5%">账号</th>
                     <th width="15%">内容</th>
                     <th width="10%">客户端IP</th>
                     <th width="5%">操作类型</th>
                     <th width="30%">URL地址</th>
                     <th width="20%">操作时间</th>
                 </tr>
                 </thead>
                 <tbody>
                 <php>foreach($log_history as $K => $v) {</php>
                     <tr>
                         <td><label><input type="checkbox" class="ace"><span class="lbl"></span></label></td>
                         <td>{$v.id}</td>
                         <td>{$v.username}</td>
                         <td>{$v.opr_name}</td>
                         <td>{$v.ip}</td>
                         <td>{$v.type}</td>
                         <td>{$v.url}</td>
                         <td><php>echo date('Y-m-d H:i:s', $v['time']);</php></td>
                     </tr>
                 <php>}</php>

                 </tbody>
             </table>
         </div>
     </div>
 </div>
</div>
 <!--修改密码样式-->
         <div class="change_Pass_style" id="change_Pass">
            <ul class="xg_style">
             <li><label class="label_name">原&nbsp;&nbsp;密&nbsp;码</label><input name="原密码" type="password" class="" id="password"></li>
             <li><label class="label_name">新&nbsp;&nbsp;密&nbsp;码</label><input name="新密码" type="password" class="" id="Nes_pas"></li>
             <li><label class="label_name">确认密码</label><input name="再次确认密码" type="password" class="" id="c_mew_pas"></li>
              
            </ul>
     <!--       <div class="center"> <button class="btn btn-primary" type="button" id="submit">确认修改</button></div>-->
         </div>
</body>
</html>
<script charset="utf-8" src="__JS__/md5.js"></script>
<script>

 //按钮点击事件
function modify(){
	 $('.text_info').attr("disabled", false);
	 $('.text_info').addClass("add");
	  $('#Personal').find('.xinxi').addClass("hover");
	  $('#Personal').find('.btn-success').css({'display':'block'});
	};
function save_info(){
    var username = $('#username').val();
    if("" == username) {
        layer.alert('账号不能为空',{
            title: '提示框',
            icon:0,
        });
        return false;
    } else {

        $("#save_change").attr("disabled", true);
        var id = $('#id').val();
//        var username = $('#username').val();
        var type = $('#type').val();

        if(type != 2) {
            var weixin_account = $('#weixin_account').val();
            var alipay_acount = $('#alipay_acount').val();
            var bank_name = $('#bank_name').val();
            var bank_user_name = $('#bank_user_name').val();
            var bank_account = $('#bank_account').val();
            var bank_branches = $('#bank_branches').val();

            $.post(  '__APP__/admin.php/Public/saveChange', {
                        id: id,
//                        type: type,
                        username: username,
                        weixin_account: weixin_account,
                        alipay_acount: alipay_acount,
                        bank_name: bank_name,
                        bank_user_name: bank_user_name,
                        bank_account: bank_account,
                        bank_branches: bank_branches,
                    },
                    function(data){
                        if(data.statusCode=="success"){
                            layer.alert(data.message,{
                                title: '提示框',
                                icon:1,
                            });
                            $("#save_change").attr("disabled", false);

//                            layer.close(index);
                        }else{

                            layer.alert(data.message,{
                                title: '提示框',
                                icon:0,
                            });
                            $('.text_info').attr("disabled", false);
                            $('.text_info').addClass("add");
                            $('#Personal').find('.xinxi').addClass("hover");
                            $('#Personal').find('.btn-success').css({'display':'block'});

                            $("#save_change").attr("disabled", false);
                            return false;
                        }
                    });
        } else {

            $.post(  '__APP__/admin.php/Public/saveChange', {
                        id: id,
//                        type: type,
                        username: username,

                    },
                    function(data){
                        if(data.statusCode=="success"){
                            layer.alert(data.message,{
                                title: '提示框',
                                icon:1,
                            });
                            $("#save_change").attr("disabled", false);
//                            layer.close(index);
                        }else{

                            layer.alert(data.message,{
                                title: '提示框',
                                icon:0,
                            });
                            $('.text_info').attr("disabled", false);
                            $('.text_info').addClass("add");
                            $('#Personal').find('.xinxi').addClass("hover");
                            $('#Personal').find('.btn-success').css({'display':'block'});

                            $("#save_change").attr("disabled", false);
                            return false;
                        }
                    });
        }


        layer.alert('修改成功！',{
            title: '提示框',
            icon:1,
        });
        $('#Personal').find('.xinxi').removeClass("hover");
        $('#Personal').find('.text_info').removeClass("add").attr("disabled", true);
        $('#Personal').find('.btn-success').css({'display':'none'});
    }

//		  }
	};	
 //初始化宽度、高度    
    $(".admin_modify_style").height($(window).height()); 
	$(".recording_style").width($(window).width()-400); 
    //当文档窗口发生改变时 触发  
    $(window).resize(function(){
	$(".admin_modify_style").height($(window).height()); 
	$(".recording_style").width($(window).width()-400); 
  });
  //修改密码
  function change_Password(){
	   layer.open({
    type: 1,
	title:'修改密码',
	area: ['300px','300px'],
	shadeClose: true,
	content: $('#change_Pass'),
	btn:['确认修改'],
	yes:function(index, layero){		
		   if ($("#password").val()==""){
			  layer.alert('原密码不能为空!',{
              title: '提示框',				
				icon:0,
			    
			 });
			return false;
          } 
		  if ($("#Nes_pas").val()==""){
			  layer.alert('新密码不能为空!',{
              title: '提示框',				
				icon:0,
			    
			 });
			return false;
          }
		   
		  if ($("#c_mew_pas").val()==""){
			  layer.alert('确认新密码不能为空!',{
              title: '提示框',				
				icon:0,
			    
			 });
			return false;
          }
		    if(!$("#c_mew_pas").val || $("#c_mew_pas").val() != $("#Nes_pas").val() )
        {
            layer.alert('新密码两次输入不一致!',{
              title: '提示框',				
				icon:0,
			    
			 });
			 return false;
        } else{
                $("#change_pwd").attr("disabled", true);
            var id = $('#id').val();
            var password = $('#password').val();
            var passwordr =  $("#Nes_pas").val();

            $.post(  '__APP__/admin.php/Public/change_pwd', { id: id, password: hex_md5( password ), passwordr: hex_md5( passwordr )  },
                    function(data){
                        if(data.statusCode=="success"){
                            layer.alert(data.message,{
                                title: '提示框',
                                icon:1,
                            });
                            $("#change_pwd").attr("disabled", false);
                        }else{

                            layer.alert(data.message,{
                                title: '提示框',
                                icon:0,
                            });

                            $("#change_pwd").attr("disabled", false);
                            return false;
                        }
                    });


		  }	 
	}

    });

	  }
</script>

